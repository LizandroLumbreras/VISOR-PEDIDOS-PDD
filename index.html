<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“‹ Ver Pedidos</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { text-align: center; margin-bottom: 20px; }
    .card {
      background: #fff; padding: 15px; border-radius: 10px;
      margin: 10px 0; box-shadow: 0 2px 6px rgba(0,0,0,.2);
    }
    .productos { margin-left: 20px; color: #333; }
    .productos li { margin-bottom: 5px; }
    .header { font-weight: bold; margin-bottom: 6px; }
  </style>
</head>
<body>
  <h1>ðŸ“‹ Pedidos Realizados</h1>
  <div id="listaPedidos"></div>

  <script>
    // ðŸ”¹ ConexiÃ³n a Supabase
    const supabase = window.supabase.createClient(
      "https://cvpbtjlupswbyxenugpz.supabase.co",  // ðŸ‘‰ tu URL
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2cGJ0amx1cHN3Ynl4ZW51Z3B6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MDIxOTQsImV4cCI6MjA2MzI3ODE5NH0.iiJsYM3TtaGPdeCtPcEXwAz3LfFc1uJGECEvOErvrqY"
    );

    async function cargarPedidos() {
      // Traer pedidos
      const { data: pedidos, error } = await supabase
        .from("pedidos")
        .select("*")
        .order("folio", { ascending: false });

      if (error) {
        alert("Error al cargar pedidos: " + error.message);
        return;
      }

      const lista = document.getElementById("listaPedidos");
      lista.innerHTML = "";

      for (let p of pedidos) {
        // Traer detalles de cada pedido
        const { data: detalles } = await supabase
          .from("pedido_detalles")
          .select("*")
          .eq("pedido_id", p.folio);

        // Crear tarjeta de pedido
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="header">Pedido #${p.folio} â€“ Cliente: ${p.cliente}</div>
          <p><b>Fecha:</b> ${new Date(p.fecha).toLocaleString()}</p>
          <p><b>Cantidad global:</b> ${p.cantidad}</p>
          <p><b>Total:</b> $${p.total}</p>
          <p><b>Forma de pago:</b> ${p.pago}</p>
          <p><b>Chofer:</b> ${p.chofer}</p>
          <p><b>Dato libre:</b> ${p.libre || "-"}</p>
          <p><b>Productos:</b></p>
          <ul class="productos">
            ${detalles && detalles.length > 0
              ? detalles.map(d => `<li>${d.cantidad} Ã— ${d.producto}</li>`).join("")
              : "<li>Sin productos</li>"
            }
          </ul>
        `;
        lista.appendChild(card);
      }
    }

    cargarPedidos();
  </script>
</body>
</html>
